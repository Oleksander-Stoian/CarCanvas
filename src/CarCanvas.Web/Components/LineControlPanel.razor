<div class="card">
    <div class="card-header bg-secondary text-white">
        <strong>Lines Control</strong>
    </div>
    <div class="card-body">
        <h6 class="small text-muted">Add Manual Line</h6>
        <div class="row g-2 mb-2">
            <div class="col-3">
                <label class="form-label small mb-0 d-block text-center">Start X</label>
                <input type="number" class="form-control form-control-sm" placeholder="X" @bind="StartX" />
            </div>
            <div class="col-3">
                <label class="form-label small mb-0 d-block text-center">Start Y</label>
                <input type="number" class="form-control form-control-sm" placeholder="Y" @bind="StartY" />
            </div>
            <div class="col-3">
                <label class="form-label small mb-0 d-block text-center">End X</label>
                <input type="number" class="form-control form-control-sm" placeholder="X" @bind="EndX" />
            </div>
            <div class="col-3">
                <label class="form-label small mb-0 d-block text-center">End Y</label>
                <input type="number" class="form-control form-control-sm" placeholder="Y" @bind="EndY" />
            </div>
        </div>
        <button class="btn btn-sm btn-outline-success w-100 mb-3" @onclick="AddLine">Add Line</button>

        <h6 class="small text-muted">Generate Random</h6>
        <div class="input-group mb-3">
            <input type="number" class="form-control form-control-sm" placeholder="N" @bind="GenerateCount" />
            <button class="btn btn-sm btn-outline-primary" @onclick="Generate">Generate</button>
        </div>

        <button class="btn btn-sm btn-danger w-100" @onclick="Clear">Clear All Lines</button>
        
        <div class="mt-2 text-muted text-center">
            <small>Total Lines: <strong>@TotalLines</strong></small>
        </div>
        
        <hr class="my-2"/>
        <div class="form-check form-switch small">
            <input class="form-check-input" type="checkbox" id="debugSwitch" checked="@ShowDebug" @onchange="OnDebugToggle">
            <label class="form-check-label" for="debugSwitch">Show Debug Boxes</label>
        </div>
    </div>
</div>

@code {
    public int? StartX { get; set; }
    public int? StartY { get; set; }
    public int? EndX { get; set; }
    public int? EndY { get; set; }
    
    public int? GenerateCount { get; set; } = 100;

    [Parameter] public int TotalLines { get; set; }
    [Parameter] public bool ShowDebug { get; set; }
    [Parameter] public EventCallback<(int x1, int y1, int x2, int y2)> OnAddLine { get; set; }
    [Parameter] public EventCallback<int> OnGenerate { get; set; }
    [Parameter] public EventCallback OnClear { get; set; }
    [Parameter] public EventCallback<bool> OnDebugChange { get; set; }

    private async Task AddLine()
    {
        if (StartX.HasValue && StartY.HasValue && EndX.HasValue && EndY.HasValue)
        {
            await OnAddLine.InvokeAsync((StartX.Value, StartY.Value, EndX.Value, EndY.Value));
            StartX = null;
            StartY = null;
            EndX = null;
            EndY = null;
        }
    }

    private async Task Generate()
    {
        if (GenerateCount.HasValue)
        {
            await OnGenerate.InvokeAsync(GenerateCount.Value);
            GenerateCount = null;
        }
    }

    private async Task Clear()
    {
        await OnClear.InvokeAsync();
    }

    private async Task OnDebugToggle(ChangeEventArgs e)
    {
        if (e.Value is bool val)
        {
            await OnDebugChange.InvokeAsync(val);
        }
    }
}
